---
import SaveTheDatePopup from "./../components/SaveTheDatePopup.astro";
---

<style>
  .highlights {
    padding: var(--spacing-xl) var(--spacing-md);
    text-align: center;
    font-family: var(--font-base);
  }

  .highlights-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .event-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    text-align: left;
    position: relative;
  }

  .event-info-text {
    flex: 1;
  }

  .calendar-badge {
    flex: 1;
    margin-top: var(--spacing-md);
    width: 100%;
    cursor: pointer;
    max-width: 320px;
    min-width: 160px;
    display: block;
    transition:
      max-width 0.3s,
      min-width 0.3s,
      width 0.3s;
  }

  .highlights-icons {
    margin-top: var(--spacing-lg);
    display: flex;
    justify-content: space-evenly;
    gap: var(--spacing-lg);
    flex-wrap: wrap;
  }

  .highlight-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: var(--color-text);
    max-width: 250px;
  }

  .highlight-item img {
    height: 60px;
    margin-bottom: var(--spacing-sm);
  }

  /* Hide/show badges based on screen size */
  .mobile-badge {
    display: none;
  }
  .mobile-badge-link {
    display: none;
  }
  .desktop-badge-link {
    display: block;
  }
  @media (max-width: 767px) {
    .event-info {
      flex-direction: column;
      align-items: flex-start;
    }
    .calendar-badge {
      width: 50vw;
      max-width: 200px;
      min-width: 60px;
      order: 2;
      align-self: flex-end;
      margin: var(--spacing-lg) 0 var(--spacing-lg) auto;
    }
    .event-info-text {
      order: 1;
    }
    .event-info-text h2,
    .event-info-text h3 {
      margin-bottom: 0.5rem;
    }
    .event-info-text p {
      margin-top: 0.5rem;
    }
    .mobile-badge {
      display: block;
      align-self: center;
      margin-left: auto;
      margin-right: auto;
    }
    .mobile-badge-link {
      display: block;
      width: 100%;
    }
    .desktop-badge-link {
      display: none;
    }
  }

  .badge-pulse-animate {
    animation: badgePulse 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  .badge-pulse-loop {
    animation: badgePulseLoop 2.5s cubic-bezier(0.35, 0, 0.7, 1) infinite;
  }
  @keyframes badgePulse {
    0% {
      transform: scale(1);
    }
    30% {
      transform: scale(0.85);
    }
    60% {
      transform: scale(1.15);
    }
    100% {
      transform: scale(1);
    }
  }
  @keyframes badgePulseLoop {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(0.98);
    }
    100% {
      transform: scale(1);
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const mobileBadge = document.querySelector(".mobile-badge");
    if (!mobileBadge) return;
    let hasAnimated = false;
    const observer = new window.IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !hasAnimated) {
            mobileBadge.classList.add("badge-pulse-animate");
            hasAnimated = true;
            setTimeout(() => {
              mobileBadge.classList.remove("badge-pulse-animate");
              mobileBadge.classList.add("badge-pulse-loop");
            }, 1200);
            observer.disconnect();
          }
        });
      },
      { threshold: 0.5 },
    );
    observer.observe(mobileBadge);
  });
</script>

<section id="highlights" class="highlights">
  <div class="highlights-content">
    <div class="event-info">
      <div class="event-info-text">
        <h2>08.–10. AUGUST 2025</h2>
        <h3>Marktplatz Troisdorf-Sieglar</h3>
        <!-- Badge for mobile, shown between h3 and p -->
        <a href="#save-date-popup" class="mobile-badge-link">
          <img
            src="./badge-save-the-date.png"
            alt="Jetzt im Kalender speichern"
            class="calendar-badge mobile-badge"
          />
        </a>
        <p>
          Zwei Tage voller Genuss, Musik und Sommerflair: <br />
          Sommer findet Stadt verwandelt den Sieglarer Marktplatz in eine kleine
          Festivaloase. <br />
          Feine Weine, schmackofatze Speisen, Live-Musik und lauschige Plätze laden
          zum Verweilen ein.
        </p>
      </div>
      <!-- Badge for desktop, stays on the right -->
      <a href="#save-date-popup" class="desktop-badge-link">
        <img
          src="./badge-save-the-date.png"
          alt="Jetzt im Kalender speichern"
          class="calendar-badge desktop-badge"
        />
      </a>
    </div>
    <div class="highlights-icons">
      <div class="highlight-item">
        <img src="./icon-glass.png" alt="Getränke Icon" />
        <p>Erfrischende Drinks & feine Weine</p>
      </div>
      <div class="highlight-item">
        <img src="./icon-music.png" alt="Musik Icon" />
        <p>Live Acts, DJs & Überraschungen</p>
      </div>
      <div class="highlight-item">
        <img src="./icon-food.png" alt="Essen Icon" />
        <p>Pizza, Pommes, Fried Chicken & mehr</p>
      </div>
    </div>
  </div>

  <SaveTheDatePopup />
</section>
